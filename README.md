# BigQuery 비용 절감 쿼리 가이드 - Claude 스킬

BigQuery 쿼리 비용을 최적화하고 불필요한 요금 낭비를 줄이기 위한 Claude 스킬입니다. 🚀

## 📖 소개

이 스킬은 Claude가 BigQuery 쿼리를 작성할 때 **비용을 최소화하고 성능을 최적화**하도록 안내합니다. 특히 GA4 마케팅 데이터와 주식/뉴스 데이터(StockAI)를 다룰 때 유용합니다.

### 주요 기능

- ✅ **파티션 필터링**: 날짜/시간 파티션을 활용한 스캔 범위 최소화
- ✅ **컬럼 선택 최적화**: `SELECT *` 금지, 필요한 컬럼만 선택
- ✅ **고급 최적화 기법**: APPROX 함수, 테이블 샘플링, 캐싱 활용
- ✅ **실전 예시**: GA4 및 StockAI 데이터를 위한 구체적인 쿼리 패턴
- ✅ **비용 모니터링**: 쿼리 비용 확인 및 분석 방법

## 🎯 사용 방법

### 1. Cursor/Claude Desktop에서 사용

1. 이 리포지토리를 클론하거나 `SKILL.md` 파일을 다운로드합니다.
2. Cursor 설정에서 스킬 파일 경로를 지정합니다.
3. BigQuery 쿼리를 작성할 때 Claude가 자동으로 이 가이드를 참고합니다.

### 2. 직접 참고

`SKILL.md` 파일을 열어서 BigQuery 쿼리 작성 시 참고하세요.

## 📚 주요 내용

### 기본 규칙
- 날짜/시간 파티션 컬럼에 반드시 필터 적용
- `SELECT *` 대신 필요한 컬럼만 선택
- 카디널리티가 낮은 컬럼으로 WHERE 조건 추가
- JOIN 시 양쪽 테이블 모두 날짜 조건 적용

### 고급 기법
- **APPROX 함수**: 정확도와 비용의 트레이드오프 (오차율 ~1%)
- **테이블 샘플링**: 탐색적 분석 시 비용 절감
- **머터리얼라이즈드 뷰**: 반복 집계 쿼리 최적화
- **쿼리 캐싱**: 24시간 내 동일 쿼리 재실행 시 비용 없음

### 실전 예시
- GA4: 채널별 세션, UTM 전환 분석, DAU 계산
- StockAI: 차트 데이터, 기술지표 JOIN, 백테스트 라벨 생성

## 💡 비용 절감 팁

1. **파티션 프루닝**: 날짜 필터로 스캔 범위 최소화
2. **컬럼 선택**: 필요한 컬럼만 선택하여 스캔 데이터 감소
3. **클러스터 활용**: 클러스터 컬럼으로 필터링
4. **LIMIT 사용**: 결과 크기 제한
5. **APPROX 함수**: 근사치로 충분한 경우 사용
6. **캐싱 활용**: 동일 쿼리 재실행 시 비용 없음

## 📁 파일 구조

```
bigquery-cost-reduction-query-guide/
├── README.md          # 이 파일
└── SKILL.md           # Claude 스킬 가이드 (상세 내용)
```

## 🔍 체크리스트

Claude가 BigQuery 쿼리를 생성할 때 자동으로 확인하는 항목들:

- [ ] 파티션 컬럼(날짜/시간)에 필터가 있는가?
- [ ] `SELECT *`를 사용하지 않았는가?
- [ ] 카디널리티를 줄이는 WHERE 조건을 사용했는가?
- [ ] JOIN 시 양쪽 모두에 날짜 조건이 적용되어 있는가?
- [ ] LIMIT 절을 적절히 사용했는가?
- [ ] APPROX 함수를 사용할 수 있는 경우인가?

더 자세한 체크리스트는 `SKILL.md`를 참고하세요.

## 🤝 기여하기

버그 리포트, 기능 제안, 개선 사항은 이슈로 등록해주세요!

## 📄 라이선스

MIT License

## 🙏 감사의 말

BigQuery 비용을 절감하고 싶은 모든 개발자들을 위해 만들어졌습니다.  
이 스킬이 도움이 되었다면 ⭐ 스타를 눌러주세요!

---

**참고**: 이 스킬은 GA4 마케팅 분석과 StockAI 주식/뉴스 플랫폼 데이터를 다룰 때 특히 유용합니다.

